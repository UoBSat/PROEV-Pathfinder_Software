<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>flight-software: Flight Software Installation and Setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MissionPatch.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">flight-software
   </div>
   <div id="projectbrief">Flight software for the PROVE Pathfinder CubeSat Payload</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespace_flight.html" title="-Software::Scheduler::scheduler">Flight</a> Software Installation and Setup </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document describes the process of installation of all of the flight software components on a completely fresh BeagleBone Black. Some links to other documentation for parts of the installation are provided. This document is still a work in progess.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Prerequisites</h1>
<ul>
<li>Clean BeagleBone Black</li>
<li>SD card (at least 4 GB)</li>
<li>USB Cable</li>
<li>Stable internet connection to the bbb (via non UoB computer)</li>
<li>GitHub API token (online guide: <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token">https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token</a>)</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
1. OS Flashing</h1>
<p >The chosen OS is Debian, with the current testing version of 10.3. The OS should be flashed on the Emmc device onboard the BBB from an SD card. For this process a "flasher" OS image should be used, see <a href="https://beagleboard.org/latest-images">https://beagleboard.org/latest-images</a> For detailed steps on how to do this follow this link:</p><ul>
<li><a href="https://beagleboard.org/getting-started">https://beagleboard.org/getting-started</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md10"></a>
2. Communication with the Board</h1>
<p >Communication with the BBB can easily be achieved over SHH via a USB cable. WinSCP (alongside putty) is the best tool to do this on windows. To establish the connection itself open winSCP and enter the following details:</p><ul>
<li>Hostname: beaglebone</li>
<li>Username: debian</li>
</ul>
<p >Then hit login, yes if any new address query appears and then enter "temppwd" as the password. WinSCP is useful for transferring files and providing a graphical insight into the filesystem on the bbb. To actually interact with the bbb use putty by clicking on its icon in the top menu bar.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
3. Required Files from the GitHub</h1>
<p >There is only 1 file required: setup.sh</p>
<p >Download the file from the latest master branch. Copy over the file to the Beaglebone using WinSCP. The file must be located at /home/debian/setup.sh.</p>
<p >Run the setup file from /home/debian with the following command:</p>
<p ><code>$ sh setup.sh</code></p>
<p >If any "not found" errors occur, run the following command and re-run the setup afterwards:</p>
<p >&lsquo;$ sed -i 's/\r$//&rsquo; setup.sh`</p>
<p >If asked, enter your GitHub username and the personal API token correctly.</p>
<p >The prompt for the internet connection will pop out. Type 'N' if the internet connection with the Beaglebone is not established and continue to the following sections.</p>
<h1><a class="anchor" id="autotoc_md12"></a>
4. Beaglebone Internet Connection</h1>
<p >For future editing, it is useful for the Beaglebone to have an active internet connection. This is complicated considerably when an external Anti-Virus is used and the way to rectify this is specific to each Anti-Virus. This may involve turning off the firewall. This method will also not work when a host device is connected to University's network (consider the following method - WiFi dongle).</p>
<p >Access the Windows Control Centre. From here --&gt; Network and Internet --&gt; Network and Sharing Center --&gt; Change Adapter Settings.</p>
<p ><img src="Win7NetworkConnectionsPanel.png" alt="alt text" title="Change Adapter Settings Screen" class="inline"/></p>
<p >Within this, there will be 2 connections, both for the Beaglebone (External Device/Gadget) and the internet connection to the host computer.</p>
<p >From the host computer internet, go to 'properties'</p>
<p ><img src="WindowsInternetWKH3ConnProperties.png" alt="alt text" title="Properties for Wireless Adapter" class="inline"/></p>
<p >then access the 'sharing' tab.</p>
<p ><img src="WindowsInternetConnPropertiesSharingTab.png" alt="alt text" title="Sharing Tab for Wireless Adapter" class="inline"/></p>
<p >From here, make sure the top box is ticked or a Home networking connection can be set</p>
<p ><img src="WindowsInternetConnPropertiesSharingTabSelectConnection.png" alt="alt text" title="Home Network Selection" class="inline"/></p>
<p >Then select the adapter associated with the Beaglebone</p>
<p ><img src="WindowsInternetConnPropertiesSharingTabSelectConnectionChecked.png" alt="alt text" title="Home Network Selected" class="inline"/></p>
<p >Move on to the Beaglebone adapter and select the IPv4 properties</p>
<p ><img src="WindowsBBConnProperties.png" alt="alt text" title="BBB Properties selection" class="inline"/></p>
<p >For BeagleBone Enhanced:</p>
<p >Change the properties of this, so that the 'Use the following IP address' is checked.</p>
<p >The IP address should be 192.168.7.1</p>
<p >The subnet mask should be 255.255.255.252</p>
<p >For Beaglebone Black:</p>
<p >Change the properties of this, so that the 'Obtain an IP address automatically' is checked.</p>
<h2><a class="anchor" id="autotoc_md13"></a>
4.1. Alternative Beaglebone Internet Connection</h2>
<p >The BeagleBone can also be connected to the internet via the dlink router (acing as an extender for a phone mobile hotspot).</p>
<p >To set this up for your phone, connect to the router's network named 'dlink-C264-5GHz' and enter the current phone's hotspot password. If the router is not currently connected to a phone hotspot the network may appear as 'ESAT-Network' and the password should be 'iljjj86635'.</p>
<p >To configure the router, enter '<a href="http://dlinkrouter.local./'">http://dlinkrouter.local./'</a> in a browser. The page will ask you log in, leave the user as adimin and enter 'DCWWROWWIFI10010' as the password. Go to wireless setting and ensure the access point mode is set to repeater- 2.4Ghz. Turn on your phone's hotspot and scroll down in your browser to site survey and press scan. Select your phone's hotspot and enter its password. Finally connect the Beagelebone to one of the ethernet ports of the router. A basic internet connection should now be established (see next steps for verifacation).</p>
<h2><a class="anchor" id="autotoc_md14"></a>
4.2. Internet Verification</h2>
<p >To verify your internet connection on the Beaglebone, ping google.com with the following command:</p>
<p ><code>$ ping google.com</code></p>
<h1><a class="anchor" id="autotoc_md15"></a>
5. Setup execution</h1>
<p >! Make sure the previous steps were successful, internet connection is required for the following !</p>
<p >Run the setup file again, this time with the internet connection:</p>
<p ><code>$ sh setup.sh</code></p>
<p >The procedure will take some time and will terminate with a reboot of the Beaglebone. Setup is now complete.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
6. Explanation of Setup</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
6.1. UART pin and serial console setup</h2>
<p >By default the BealgeBone uses UART 0 on the serial debug header as the primary serial console. However this has been changed for our purposes, to simplify PCB design to be UART1 that appears on the P9 header. this has been done, alongside the actual enabling of UARTs 1,2 and 4 by editing the /boot/uEnv.txt file (or /boot/uboot/uEnv.txt on older beaglebone images). the commands below can be run to check pin modes: </p><div class="fragment"><div class="line">cd /opt/scripts/device/bone</div>
<div class="line">sudo ./show-pins.pl</div>
</div><!-- fragment --><p> The contents of the uEnv.txt file is edited when executing the setup.sh script and should be the following (minus comments): </p><div class="fragment"><div class="line">#Docs: http://elinux.org/Beagleboard:U-boot_partitioning_layout_2.0</div>
<div class="line"> </div>
<div class="line">uname_r=4.19.94-ti-r42</div>
<div class="line">#uuid=</div>
<div class="line">#dtb=</div>
<div class="line"> </div>
<div class="line">###U-Boot Overlays###</div>
<div class="line">###Documentation: http://elinux.org/Beagleboard:BeagleBoneBlack_Debian#U-Boot_Overlays</div>
<div class="line">###Master Enable</div>
<div class="line">disable_uboot_overlay_video=1</div>
<div class="line">disable_uboot_overlay_audio=1</div>
<div class="line"> </div>
<div class="line">enable_uboot_overlays=1</div>
<div class="line"># UART 1</div>
<div class="line">uboot_overlay_addr0=/lib/firmware/BB-UART1-00A0.dtbo</div>
<div class="line"># UART 2</div>
<div class="line">uboot_overlay_addr1=/lib/firmware/BB-UART2-00A0.dtbo</div>
<div class="line"># UART 4</div>
<div class="line">uboot_overlay_addr2=/lib/firmware/BB-UART4-00A0.dtbo</div>
<div class="line"># UART 5</div>
<div class="line">uboot_overlay_addr3=/lib/firmware/BB-UART5-00A0.dtbo</div>
<div class="line"># UART 3 (only TX). Note that in &quot;uboot_overlay_addrX&quot;, the X need not be = UART id</div>
<div class="line">uboot_overlay_addr4=/lib/firmware/BB-UART3-00A0.dtbo</div>
<div class="line"> </div>
<div class="line">###</div>
<div class="line">###Overide capes with eeprom</div>
<div class="line">#uboot_overlay_addr0=/lib/firmware/&lt;file0&gt;.dtbo</div>
<div class="line">#uboot_overlay_addr1=/lib/firmware/&lt;file1&gt;.dtbo</div>
<div class="line">#uboot_overlay_addr2=/lib/firmware/&lt;file2&gt;.dtbo</div>
<div class="line">#uboot_overlay_addr3=/lib/firmware/&lt;file3&gt;.dtbo</div>
<div class="line">###</div>
<div class="line">###Additional custom capes</div>
<div class="line">#uboot_overlay_addr4=/lib/firmware/&lt;file4&gt;.dtbo</div>
<div class="line">#uboot_overlay_addr5=/lib/firmware/&lt;file5&gt;.dtbo</div>
<div class="line">#uboot_overlay_addr6=/lib/firmware/&lt;file6&gt;.dtbo</div>
<div class="line">#uboot_overlay_addr7=/lib/firmware/&lt;file7&gt;.dtbo</div>
<div class="line">###</div>
<div class="line">###Custom Cape</div>
<div class="line">#dtb_overlay=/lib/firmware/&lt;file8&gt;.dtbo</div>
<div class="line">###</div>
<div class="line">###Disable auto loading of virtual capes (emmc/video/wireless/adc)</div>
<div class="line">#disable_uboot_overlay_emmc=1</div>
<div class="line">#disable_uboot_overlay_video=1</div>
<div class="line">#disable_uboot_overlay_audio=1</div>
<div class="line">#disable_uboot_overlay_wireless=1</div>
<div class="line">#disable_uboot_overlay_adc=1</div>
<div class="line">###</div>
<div class="line">###PRUSS OPTIONS</div>
<div class="line">###pru_rproc (4.14.x-ti kernel)</div>
<div class="line">#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo</div>
<div class="line">###pru_rproc (4.19.x-ti kernel)</div>
<div class="line">uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-19-TI-00A0.dtbo</div>
<div class="line">###pru_uio (4.14.x-ti, 4.19.x-ti &amp; mainline/bone kernel)</div>
<div class="line">#uboot_overlay_pru=/lib/firmware/AM335X-PRU-UIO-00A0.dtbo</div>
<div class="line">###</div>
<div class="line">###Cape Universal Enable</div>
<div class="line">enable_uboot_cape_universal=1</div>
<div class="line">###</div>
<div class="line">###Debug: disable uboot autoload of Cape</div>
<div class="line">#disable_uboot_overlay_addr0=1</div>
<div class="line">#disable_uboot_overlay_addr1=1</div>
<div class="line">#disable_uboot_overlay_addr2=1</div>
<div class="line">#disable_uboot_overlay_addr3=1</div>
<div class="line">###</div>
<div class="line">###U-Boot fdt tweaks... (60000 = 384KB)</div>
<div class="line">#uboot_fdt_buffer=0x60000</div>
<div class="line">###U-Boot Overlays###</div>
<div class="line"> </div>
<div class="line">cmdline=coherent_pool=1M net.ifnames=0 lpj=1990656 rng_core.default_quality=100 quiet</div>
<div class="line"> </div>
<div class="line">#In the event of edid real failures, uncomment this next line:</div>
<div class="line">#cmdline=coherent_pool=1M net.ifnames=0 lpj=1990656 rng_core.default_quality=100 quiet video=HDMI-A-1:1024x768@60e</div>
<div class="line"> </div>
<div class="line">##enable Generic eMMC Flasher:</div>
<div class="line">##make sure, these tools are installed: dosfstools rsync</div>
<div class="line">#cmdline=init=/opt/scripts/tools/eMMC/init-eMMC-flasher-v3.sh</div>
<div class="line"> </div>
<div class="line">#cape_disable=capemgr.disable_partno=BB-BONELT-HDMI,BB-BONELT-HDMIN</div>
<div class="line">cape_enable=capemgr.enable_partno=BB-UART1,BB-UART2,BB-UART4,BB-UART5</div>
<div class="line">optargs= console=ttyS1,115200</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
