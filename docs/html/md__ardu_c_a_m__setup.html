<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>flight-software: ArduCAM OV5642</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MissionPatch.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">flight-software
   </div>
   <div id="projectbrief">Flight software for the PROVE Pathfinder CubeSat Payload</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">ArduCAM OV5642 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >This document provides instructions on a setup of ArduCAM (<a href="https://www.arducam.com/product/arducam-5mp-plus-spi-cam-arduino-ov5642/">product link</a>), SPI interfacing on the beaglebone black, and image capturing.</p>
<p >For any questions, please contact <em>Vilius Stonkus</em> (<a href="#" onclick="location.href='mai'+'lto:'+'zh1'+'97'+'37@'+'br'+'ist'+'ol'+'.ac'+'.u'+'k'; return false;">email</a>). </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Prerequisites</h1>
<ol type="1">
<li>ArduCAM official library from <a href="https://github.com/ArduCAM/BeagleboneBlack">here</a>. We are using modified version of the library which is tailored for our needs.</li>
<li>For compilation and Python bindings, <code>cmake</code>, <code>make</code> and <code>Cython</code> packages are required </li>
</ol>
<h1><a class="anchor" id="autotoc_md2"></a>
Camera Connection</h1>
<p >We are using the <b>SPI0 device</b>. On Debian 10.3, the pins described below connect to the <b>spidev0.0</b> channel.</p>
<p >Connect the ArduCAM to the following SPI pins:</p><ul>
<li>P9_22 =&gt; SPI0_SCLK</li>
<li>P9_18 =&gt; SPI0_MOSI</li>
<li>P9_21 =&gt; SPI0_MISO</li>
<li>P9_17 =&gt; SPI0_CSO</li>
</ul>
<p >The camera is also using the i2c interfacing for sensor communications. On Debian 10.3, the <b>i2c-2</b> device is used.</p>
<p >Connect the ArduCAM to the following I2C pins:</p><ul>
<li>P9_19 =&gt; I2C2_SCL</li>
<li>P9_20 =&gt; I2C2_SDA</li>
</ul>
<p >The camera can operate at either 3.3V or 5V. </p>
<h1><a class="anchor" id="autotoc_md3"></a>
Enable SPI</h1>
<p >By default, the SPI interface is disabled on the BeagleBone Black. Both SPI devices (0 and 1) have to be enabled manually. We are only using the SPI0 device for camera, so we will only enable this device.</p>
<p >The standard procedure is as follows (based on <a href="https://www.element14.com/community/community/designcenter/single-board-computers/next-genbeaglebone/blog/2019/07/28/beaglebone-enable-spi-with-overlay">this</a>):</p><ul>
<li>Open the uEnv.txt file: <code>sudo nano /boot/uEnv.txt</code></li>
<li>Scroll down to <code>uboot_overlay_addr4</code>, uncomment it (or add a new entry) and include the SPI0 overlay file path: <code>uboot_overlay_addr4=/lib/firmware/BB-SPIDEV0-00A0.dtbo</code></li>
<li>Reboot your Beaglebone: <code>sudo reboot now</code></li>
</ul>
<p >The SPI0 interface should now be working. In order to test it, a spidev-test repository can be used (<a href="https://github.com/derekmolloy/exploringBB/tree/version2/chp08/spi/spidev_test">repo</a>):</p><ul>
<li>Compile the spidev_test.c file: <code>gcc spidev_test.c -o spidev_test</code></li>
<li>Run the spidev_test executable: <code>./spidev_test</code>, or for a specific device: <code>./spidev_test --device /dev/spidev0.0</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md4"></a>
Library Compilation</h1>
<p >A custom Makefile has been created for the library compilation. It should be located at <code>/home/debian/Tasks/arducam</code> together with all other ArduCAM files.</p>
<p >To compile the library, simply run <code>make</code> in the same directory where the Makefile is located.</p>
<p >A shared object file <code>pyBBBCAM.so</code> will be generated, which will act as an importable Python module.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Image Capture</h1>
<p >To start the capturing process, simply run the <code><a class="el" href="arducam_8py.html">arducam.py</a></code> file from <code>/home/debian/Tasks/arducam</code>.</p>
<p >The number of images to be captured is described by a list of timestamps.</p>
<p >This is the standard cmd to start the capturing: <code>sudo python3 <a class="el" href="arducam_8py.html">arducam.py</a> --times [timestamps]</code>, where <code>[timestamps]</code> is a list of unix timestamps separated by single spacings.</p>
<p >E.g. <code>sudo python3 <a class="el" href="arducam_8py.html">arducam.py</a> --times 1627652497 1627652597</code> will capture 2 images at 2 specific timestamps.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
File Structure</h1>
<p >The standard file structure of <code>/home/debian/arducam/</code>. </p><div class="fragment"><div class="line">├── arducam.py</div>
<div class="line">├── default_properties.json</div>
<div class="line">├── libs</div>
<div class="line">│   ├── arducam-bbb</div>
<div class="line">│   │   ├── arducam-bbb      // Library header files</div>
<div class="line">│   │   │   ├── BBBCAM.h</div>
<div class="line">│   │   │   ├── BBBCAM_OV5642_DigitalCamera.h</div>
<div class="line">│   │   │   ├── memorysaver.h</div>
<div class="line">│   │   │   ├── mt9d111_regs.h</div>
<div class="line">│   │   │   ├── ov2640_regs.h</div>
<div class="line">│   │   │   ├── ov3640_regs.h</div>
<div class="line">│   │   │   ├── ov5642_regs.h</div>
<div class="line">│   │   │   ├── ov7660_regs.h</div>
<div class="line">│   │   │   ├── ov7670_regs.h</div>
<div class="line">│   │   │   ├── ov7675_regs.h</div>
<div class="line">│   │   │   ├── ov7725_regs.h</div>
<div class="line">│   │   │   └── UTFT_SPI.h</div>
<div class="line">│   │   ├── build            // Library build files generated with cmake</div>
<div class="line">│   │   │   ├── CMakeCache.txt</div>
<div class="line">│   │   │   ├── CMakeFiles</div>
<div class="line">│   │   │   │   ├── 3.13.4</div>
<div class="line">│   │   │   │   │   ├── CMakeCCompiler.cmake</div>
<div class="line">│   │   │   │   │   ├── CMakeCXXCompiler.cmake</div>
<div class="line">│   │   │   │   │   ├── CMakeDetermineCompilerABI_C.bin</div>
<div class="line">│   │   │   │   │   ├── CMakeDetermineCompilerABI_CXX.bin</div>
<div class="line">│   │   │   │   │   ├── CMakeSystem.cmake</div>
<div class="line">│   │   │   │   │   ├── CompilerIdC</div>
<div class="line">│   │   │   │   │   │   ├── a.out</div>
<div class="line">│   │   │   │   │   │   ├── CMakeCCompilerId.c</div>
<div class="line">│   │   │   │   │   │   └── tmp</div>
<div class="line">│   │   │   │   │   └── CompilerIdCXX</div>
<div class="line">│   │   │   │   │       ├── a.out</div>
<div class="line">│   │   │   │   │       ├── CMakeCXXCompilerId.cpp</div>
<div class="line">│   │   │   │   │       └── tmp</div>
<div class="line">│   │   │   │   ├── arducam-bbb.dir</div>
<div class="line">│   │   │   │   │   ├── build.make</div>
<div class="line">│   │   │   │   │   ├── C.includecache</div>
<div class="line">│   │   │   │   │   ├── cmake_clean.cmake</div>
<div class="line">│   │   │   │   │   ├── cmake_clean_target.cmake</div>
<div class="line">│   │   │   │   │   ├── DependInfo.cmake</div>
<div class="line">│   │   │   │   │   ├── depend.internal</div>
<div class="line">│   │   │   │   │   ├── depend.make</div>
<div class="line">│   │   │   │   │   ├── flags.make</div>
<div class="line">│   │   │   │   │   ├── link.txt</div>
<div class="line">│   │   │   │   │   ├── progress.make</div>
<div class="line">│   │   │   │   │   └── source</div>
<div class="line">│   │   │   │   │       ├── BBBCAM.c.o</div>
<div class="line">│   │   │   │   │       ├── BBBCAM_OV5642_DigitalCamera.c.o</div>
<div class="line">│   │   │   │   │       └── UTFT_SPI.c.o</div>
<div class="line">│   │   │   │   ├── cmake.check_cache</div>
<div class="line">│   │   │   │   ├── CMakeDirectoryInformation.cmake</div>
<div class="line">│   │   │   │   ├── CMakeOutput.log</div>
<div class="line">│   │   │   │   ├── CMakeTmp</div>
<div class="line">│   │   │   │   ├── feature_tests.bin</div>
<div class="line">│   │   │   │   ├── feature_tests.c</div>
<div class="line">│   │   │   │   ├── feature_tests.cxx</div>
<div class="line">│   │   │   │   ├── Makefile2</div>
<div class="line">│   │   │   │   ├── Makefile.cmake</div>
<div class="line">│   │   │   │   ├── progress.marks</div>
<div class="line">│   │   │   │   └── TargetDirectories.txt</div>
<div class="line">│   │   │   ├── cmake_install.cmake</div>
<div class="line">│   │   │   ├── libarducam-bbb.a</div>
<div class="line">│   │   │   └── Makefile</div>
<div class="line">│   │   ├── CMakeLists.txt</div>
<div class="line">│   │   └── source           // Library source files</div>
<div class="line">│   │       ├── BBBCAM.c</div>
<div class="line">│   │       ├── BBBCAM_OV2640_DigitalCamera.c</div>
<div class="line">│   │       ├── BBBCAM_OV2640_Playback.c</div>
<div class="line">│   │       ├── BBBCAM_OV3640_Playback.c</div>
<div class="line">│   │       ├── BBBCAM_OV5642_DigitalCamera.c</div>
<div class="line">│   │       ├── BBBCAM_OV5642_Playback.c</div>
<div class="line">│   │       ├── BBBCAM_OV7670_Playback.c</div>
<div class="line">│   │       ├── DefaultFonts_SPI.c</div>
<div class="line">│   │       └── UTFT_SPI.c</div>
<div class="line">│   └── system_memory.c      // CPU and RAM consumption</div>
<div class="line">├── Makefile                 // Custom Makefile for library compilation</div>
<div class="line">├── notes</div>
<div class="line">│   └── configuration properties.txt</div>
<div class="line">├── pyBBBCAM.pyc</div>
<div class="line">├── pyBBBCAM.pyx             // Python bindings for C functions, using Cython wrapper</div>
<div class="line">├── pyBBBCAM.so              // Shared object file. Acts as a Python module</div>
<div class="line">├── README.md</div>
<div class="line">├── setup.py                 // Setup file for Cython wrapper</div>
<div class="line">└── spi_test                 // SPI testing using Python and C</div>
<div class="line">    ├── spidev_test</div>
<div class="line">    ├── spidev_test.c</div>
<div class="line">    └── spitest.py</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
